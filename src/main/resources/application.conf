http {
  proxy-host = "127.0.0.1"
  proxy-host = ${?PROXY_HOST}

  proxy-port = 8888
  proxy-port = ${?PROXY_PORT}

  request-max-total-attempts = 3
  request-max-total-attempts = ${?HTTP_REQUEST_MAX_TOTAL_ATTEMPTS}

  request-per-attempt-timeout = 2 seconds
  request-per-attempt-timeout = ${?HTTP_REQUEST_PER_ATTEMPT_TIMEOUT}

  request-max-delay-between-attempts = 100 milliseconds
  request-max-delay-between-attempts = ${?HTTP_REQUEST_MAX_DELAY_BETWEEN_ATTEMPTS}

  max-total-connections = 8192
  max-total-connections = ${?HTTP_MAX_TOTAL_CONNECTIONS}

  max-total-connections-per-host = 4096
  max-total-connections-per-host = ${?HTTP_MAX_TOTAL_CONNECTIONS_PER_HOST}
}

clickhouse {
  url = "jdbc:clickhouse://localhost:8123/"
  url = ${?CLICKHOUSE_URL}

  user = "default"
  user = ${?CLICKHOUSE_USER}

  pass = ""
  pass = ${?CLICKHOUSE_PASSWORD}

  thread-pool-size = 16
}

kafka {
  bootstrap-servers = "localhost:9092"
  bootstrap-servers = ${?KAFKA_BOOTSTRAP_SERVERS}
}

schema-registry {
  base-url = "http://localhost:8081"
  base-url = ${?SCHEMA_REGISTRY_BASE_URL}
}

parser {
  kafka-consumer {
    group-id = "marketplace_parser"
    group-id = ${?PARSER_KAFKA_CONSUMER_GROUP_ID}

    topic = "markeplace_crawler-events-ozon_request_handled-version_1"
    topic = ${?PARSER_KAFKA_CONSUMER_TOPIC}

    max-poll-records = 250
    max-poll-records = ${?PARSER_KAFKA_CONSUMER_MAX_POLL_RECORDS}

    max-poll-interval = 20 minutes
    max-poll-interval = ${?PARSER_KAFKA_CONSUMER_MAX_POLL_INTERVAL}

    commit-every-n-offsets = 256
    commit-every-n-offsets = ${?PARSER_KAFKA_CONSUMER_COMMIT_EVERY_N_OFFSETS}
    
    commit-timeout = 30 seconds
    commit-timeout = ${?PARSER_KAFKA_CONSUMER_COMMIT_TIMEOUT}

    commit-time-window = 500 milliseconds
    commit-time-window = ${?PARSER_KAFKA_CONSUMER_COMMIT_TIME_WINDOW}
  }

  kafka-producer {
    topic = "marketplace_parser-results-ozon_category_search_results_v2_items-version_1"
    topic = ${?PARSER_KAFKA_PRODUCER_TOPIC}

    max-buffer-size = 512
    max-buffer-size = ${?PARSER_KAFKA_PRODUCER_MAX_BUFFER_SIZE}

    linger = 100 milliseconds
    linger = ${?PARSER_KAFKA_PRODUCER_LINGER}

    batch-size = 16384
    batch-size = ${?PARSER_KAFKA_PRODUCER_BATCH_SIZE}
  }
}

crawler {
  max-connections-per-partition = 128
  max-connections-per-partition = ${?CRAWLER_MAX_CONNECTIONS_PER_PARTITION}

  kafka-consumer {
    group-id = "marketplace_crawler"
    group-id = ${?CRAWLER_KAFKA_CONSUMER_GROUP_ID}

    topic = "marketplace_crawler-commands-handle_ozon_request-version_1"
    topic = ${?CRAWLER_KAFKA_CONSUMER_TOPIC}

    max-poll-records = 64
    max-poll-records = ${?CRAWLER_KAFKA_CONSUMER_MAX_POLL_RECORDS}

    max-poll-interval = 5 minutes
    max-poll-interval = ${?CRAWLER_KAFKA_CONSUMER_MAX_POLL_INTERVAL}

    commit-timeout = 10 minutes
    commit-timeout = ${?CRAWLER_KAFKA_CONSUMER_COMMIT_TIMEOUT}

    commit-every-n-offsets = 64
    commit-every-n-offsets = ${?CRAWLER_KAFKA_CONSUMER_COMMIT_EVERY_N_OFFSETS}

    commit-time-window = 500 milliseconds
    commit-time-window = ${?CRAWLER_KAFKA_CONSUMER_COMMIT_TIME_WINDOW}
  }

  kafka-producer {
    topic = "markeplace_crawler-events-ozon_request_handled-version_1"
    topic = ${?CRAWLER_KAFKA_PRODUCER_TOPIC}

    compression-type = "zstd"
    compression-type = ${?CRAWLER_KAFKA_PRODUCER_COMPRESSION_TYPE}

    max-buffer-size = 128
    max-buffer-size = ${?CRAWLER_KAFKA_PRODUCER_MAX_BUFFER_SIZE}

    linger = 50 milliseconds
    linger = ${?CRAWLER_KAFKA_PRODUCER_LINGER}

    batch-size = 655360
    batch-size = ${?CRAWLER_KAFKA_PRODUCER_BATCH_SIZE}
  }
}

scheduler {
  kafka-producer {
    topic = "marketplace_crawler-commands-handle_ozon_request-version_1"
    topic = ${?SCHEDULER_KAFKA_PRODUCER_TOPIC}

    max-buffer-size = 128
    max-buffer-size = ${?SCHEDULER_KAFKA_PRODUCER_MAX_BUFFER_SIZE}

    linger = 50 milliseconds
    linger = ${?SCHEDULER_KAFKA_PRODUCER_LINGER}

    batch-size = 8192
    batch-size = ${?SCHEDULER_KAFKA_PRODUCER_BATCH_SIZE}
  }
}

sources = [
  { type = ozon-category, id = 6000,  every = 30 minutes }
  { type = ozon-category, id = 6500,  every = 30 minutes }
  { type = ozon-category, id = 7000,  every = 30 minutes }
  { type = ozon-category, id = 7500,  every = 30 minutes }
  { type = ozon-category, id = 8000,  every = 30 minutes }
  { type = ozon-category, id = 8500,  every = 30 minutes }
  { type = ozon-category, id = 9000,  every = 30 minutes }
  { type = ozon-category, id = 9200,  every = 30 minutes }
  { type = ozon-category, id = 9700,  every = 30 minutes }
  { type = ozon-category, id = 10500, every = 30 minutes }
  { type = ozon-category, id = 11000, every = 30 minutes }
  { type = ozon-category, id = 12300, every = 30 minutes }
  { type = ozon-category, id = 13100, every = 30 minutes }
  { type = ozon-category, id = 13300, every = 30 minutes }
  { type = ozon-category, id = 13500, every = 30 minutes }
  { type = ozon-category, id = 14500, every = 30 minutes }
  { type = ozon-category, id = 14572, every = 30 minutes }
  { type = ozon-category, id = 15000, every = 30 minutes }
  { type = ozon-category, id = 15500, every = 30 minutes }
  { type = ozon-category, id = 16500, every = 30 minutes }
  { type = ozon-category, id = 18000, every = 30 minutes }
  { type = ozon-category, id = 25000, every = 30 minutes }
  { type = ozon-category, id = 32056, every = 30 minutes }
  { type = ozon-category, id = 33332, every = 30 minutes }
  { type = ozon-category, id = 34452, every = 30 minutes }
  { type = ozon-category, id = 35659, every = 30 minutes }
  { type = ozon-category, id = 50001, every = 30 minutes }
]

